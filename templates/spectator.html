<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ê²½ë§¤ ëŒ€ì‹œë³´ë“œ - {{ username }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" href="{{ url_for('static', filename='image/logo_c_csgns_bgr_ER1.png') }}" type="image/png">
  <style>
    @font-face {
      font-family: 'S-CoreDream-3Light';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-3Light.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }
    body {
      font-family: 'S-CoreDream-3Light', 'Segoe UI', sans-serif;
      margin: 0;
      background-color: #f8f9fa;
      height: 100vh;
      overflow: hidden;
    }
    .dashboard {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .top-bar {
      padding: 10px 20px;
      background-color: #343a40;
      color: white;
    }
    .main-content {
      flex: 1;
      display: flex;
      gap: 10px;
      padding: 10px;
      overflow: hidden;
    }
    .panel {
      background-color: white;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      overflow: auto;
    }
    .left-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .right-panel {
      flex: 1.2;
    }
    .panel h2 {
      font-size: 1.25rem;
    }
    table {
      width: 100%;
    }
    .footer {
      background-color: #fff;
      padding: 10px 20px;
      border-top: 1px solid #dee2e6;
      text-align: center;
    }
    .table-success td {
      background-color: #d4edda !important;
    }
    .table-danger td {
      background-color: #f8d7da !important;
    }
    #auction-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9999;
      color: white;
      font-size: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
  </style>
</head>
<body style="-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none">
  <div class="dashboard">
    <div class="top-bar d-flex justify-content-between align-items-center">
      <h4 class="mb-0">
        ğŸ† Spectator Dashboard 
        <small class="text-muted">Logged in as: {{ username }}</small>
      </h4>
    
      <form action="{{ url_for('logout') }}" method="POST" class="mb-0">
        <button type="submit" class="btn btn-sm btn-outline-danger">Logout</button>
      </form>
    </div>
    <div class="main-content">
      <!-- Left Panel -->
      <div class="panel left-panel">
        <div>
          <h2>ğŸ”” í˜„ì¬ ê²½ë§¤</h2>
          <div id="current-player-box">
            <p><strong>ì´ë¦„:</strong> <span id="player-name">ë¶ˆëŸ¬ì˜¤ëŠ”ì¤‘...</span></p>
            <p><strong>í˜„ì¬ ì…ì°°ê°€:</strong> <span id="current-bid">-</span></p>
            <p><strong>ìµœê³ ê°€ ì…ì°°ì:</strong> <span id="highest-bidder">-</span></p>
            <p><strong>ë‚¨ì€ ì‹œê°„:</strong> <span id="time-remaining">-</span></p>
            <p class="text-muted">â€» ë³¸ ì„œë²„ëŠ” í•´ì™¸ë§ì— ì¡´ì¬í•˜ë¯€ë¡œ ì•½ê°„ì˜ ë”œë ˆì´ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          </div>
        </div>
        <div class="mt-4">
          <h2>ğŸ§‘â€ğŸ¤â€ğŸ§‘ íŒ€ í˜„í™©</h2>
          <table class="table table-sm table-bordered" id="team-status">
            <thead class="table-light">
              <tr>
                <th>ì£¼ì¥</th>
                <th style="width:60%">ì…ì°°ëœ ì„ ìˆ˜</th>
                <th>ì‚¬ìš©í•œ í¬ì¸íŠ¸</th>
                <th>ë‚¨ì€ í¬ì¸íŠ¸</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Right Panel -->
      <div class="panel right-panel">
        <h2>ğŸ“‹ ì „ì²´ ì„ ìˆ˜ ëª©ë¡</h2>
        <table class="table table-sm table-bordered" id="all-players">
          <thead class="table-light">
            <tr>
              <th>ë²ˆí˜¸</th>
              <th>ì´ë¦„</th>
              <th>ì…ì°°ê°€</th>
              <th>ì…ì°°ì£¼</th>
              <th>ìƒíƒœ</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <div class="footer small text-muted">
      &copy; STUDIO CSGNS All Right Reserved.
    </div>
  </div>

  <!-- ì˜¤ë²„ë ˆì´: ê²½ë§¤ ì¢…ë£Œ ì‹œ í‘œì‹œ -->
  <div id="auction-overlay">âš ï¸ ê²½ë§¤ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. âš ï¸<br>ê´€ë¦¬ìì— ì˜í•´ ê²½ë§¤ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</div>

<script>
  function updateCurrentPlayer() {
    $.get('/current_player', function (data) {
      if (data.status === 'waiting') {
        $('#player-name').text('ê²½ë§¤ê°€ ì¼ì‹œì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€ê¸°ì¤‘...');
        $('#current-bid').text('-');
        $('#highest-bidder').text('-');
        $('#time-remaining').text('-');
      } else {
        $('#player-name').text(data.name);
        $('#current-bid').text(data.current_bid);
        $('#highest-bidder').text(data.highest_bidder || '-');
        $('#time-remaining').text(data.remaining_time + ' ì´ˆ');
      }
    });
  }

  function updateTeamStatus() {
    $.get('/team_status', function (data) {
      const tbody = $('#team-status tbody');
      tbody.empty();
      for (const captain in data) {
        const info = data[captain];
        tbody.append(`
          <tr>
            <td>${captain}</td>
            <td>${info.members.join(', ')}</td>
            <td>${info.points_used}</td>
            <td>${info.points_left}</td>
          </tr>
        `);
      }
    });
  }

  function updateAllPlayers() {
    $.get('/all_players', function (data) {
      const tbody = $('#all-players tbody');
      tbody.empty();
      for (const p of data) {
        let rowClass = "";
        if (p.is_sold) rowClass = "table-success";
        else if (p.current_bid === 0 && p.highest_bidder === null) rowClass = "table-danger";
        tbody.append(`
          <tr class="${rowClass}">
            <td>${p.id}</td>
            <td>${p.name}</td>
            <td>${p.current_bid}</td>
            <td>${p.highest_bidder || '-'}</td>
            <td>${p.is_sold ? "ê²½ë§¤ ì™„ë£Œ!" : "ëŒ€ê¸°ì¤‘..."}</td>
          </tr>
        `);
      }
    });
  }

  function checkServerMessage() {
    $.get('/server_message', function(data) {
      if (data.message.includes("ê²½ë§¤ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤")) {
        $('#auction-overlay').show();
      } else {
        $('#auction-overlay').hide();
      }
    });
  }

  // ì‹¤ì‹œê°„ ë°˜ì˜
  setInterval(() => {
    updateCurrentPlayer();
    updateTeamStatus();
    updateAllPlayers();
    checkServerMessage();
  }, 1000);
</script>

</body>
</html>
